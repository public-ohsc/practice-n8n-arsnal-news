{
  "name": "BBC Football RSS â†’ ì•„ìŠ¤ë‚  ë‰´ìŠ¤ ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 12 * * *"
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "ë§¤ì¼ ì˜¤í›„ 12ì‹œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "http://feeds.bbci.co.uk/sport/football/rss.xml",
        "options": {}
      },
      "id": "bbc-rss",
      "name": "BBC Football RSS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "jsCode": "// BBC Sport Football RSSì—ì„œ ì•„ìŠ¤ë‚  ë‰´ìŠ¤ ì¶”ì¶œ\nconst xml = $input.first().json.data;\n\nconsole.log('=== BBC Sport Football RSS íŒŒì‹± ì‹œì‘ ===');\n\n// ì•„ìŠ¤ë‚  ê´€ë ¨ í‚¤ì›Œë“œë“¤\nconst arsenalKeywords = [\n  'Arsenal', 'Gunners', 'Arteta', 'Odegaard', 'Saka', \n  'Martinelli', 'Rice', 'Saliba', 'Gabriel', 'Zinchenko',\n  'Havertz', 'Jesus', 'Emirates', 'North London'\n];\n\nconst newsItems = [];\n\n// ë‹¨ìˆœí•œ ë°©ì‹ìœ¼ë¡œ item íƒœê·¸ë“¤ì„ ë¶„ë¦¬\nconst itemMatches = xml.match(/<item>[\\s\\S]*?<\\/item>/g);\nconsole.log('ë°œê²¬ëœ item ê°œìˆ˜:', itemMatches ? itemMatches.length : 0);\n\nif (itemMatches) {\n  for (const item of itemMatches) {\n    // title ì¶”ì¶œ (CDATA í˜•ì‹)\n    const titleMatch = item.match(/<title><!\\[CDATA\\[([^\\]]*)\\]\\]><\\/title>/);\n    const title = titleMatch ? titleMatch[1].trim() : '';\n    \n    // link ì¶”ì¶œ - ì—¬ëŸ¬ íŒ¨í„´ ì‹œë„\n    let link = '';\n    \n    // íŒ¨í„´ 1: CDATA í˜•ì‹\n    const linkMatch1 = item.match(/<link><!\\[CDATA\\[([^\\]]*)\\]\\]><\\/link>/);\n    if (linkMatch1) {\n      link = linkMatch1[1].trim();\n    } else {\n      // íŒ¨í„´ 2: ì¼ë°˜ í˜•ì‹\n      const linkMatch2 = item.match(/<link>([^<]*)<\\/link>/);\n      if (linkMatch2) {\n        link = linkMatch2[1].trim();\n      }\n    }\n    \n    // íŒ¨í„´ 3: guidì—ì„œ ì¶”ì¶œ (BBCëŠ” guidì— ë§í¬ê°€ ìˆìŒ)\n    if (!link) {\n      const guidMatch = item.match(/<guid[^>]*>([^<]*)<\\/guid>/);\n      if (guidMatch) {\n        link = guidMatch[1].trim();\n      }\n    }\n    \n    // description ì¶”ì¶œ (CDATA í˜•ì‹)\n    const descMatch = item.match(/<description><!\\[CDATA\\[([^\\]]*)\\]\\]><\\/description>/);\n    const description = descMatch ? descMatch[1].trim() : '';\n    \n    console.log('--- ë‰´ìŠ¤ ì•„ì´í…œ ë¶„ì„ ---');\n    console.log('ì œëª©:', title);\n    console.log('ë§í¬:', link);\n    console.log('ì„¤ëª…:', description.substring(0, 100));\n    \n    // ì•„ìŠ¤ë‚  ê´€ë ¨ ë‰´ìŠ¤ íŒë‹¨\n    let isArsenalNews = false;\n    let reason = '';\n    \n    // 1. ì œëª©ì— ì•„ìŠ¤ë‚  í‚¤ì›Œë“œê°€ ìˆëŠ” ê²½ìš°\n    const titleHasArsenal = arsenalKeywords.some(keyword => \n      title.toLowerCase().includes(keyword.toLowerCase())\n    );\n    \n    if (titleHasArsenal) {\n      isArsenalNews = true;\n      reason = 'ì œëª©ì— ì•„ìŠ¤ë‚  í‚¤ì›Œë“œ í¬í•¨';\n    }\n    \n    // 2. ì„¤ëª…ì— ì•„ìŠ¤ë‚  í‚¤ì›Œë“œê°€ ìˆëŠ” ê²½ìš°\n    const descHasArsenal = arsenalKeywords.some(keyword => \n      description.toLowerCase().includes(keyword.toLowerCase())\n    );\n    \n    if (descHasArsenal) {\n      isArsenalNews = true;\n      reason = reason ? reason + ', ì„¤ëª…ì— ì•„ìŠ¤ë‚  í‚¤ì›Œë“œ í¬í•¨' : 'ì„¤ëª…ì— ì•„ìŠ¤ë‚  í‚¤ì›Œë“œ í¬í•¨';\n    }\n    \n    console.log('ì•„ìŠ¤ë‚  ê´€ë ¨ ì—¬ë¶€:', isArsenalNews, '- ì´ìœ :', reason);\n    \n    if (isArsenalNews) {\n      newsItems.push({\n        title: title,\n        link: link || 'http://feeds.bbci.co.uk/sport/football/rss.xml',\n        timestamp: new Date().toISOString(),\n        team: 'Arsenal',\n        description: description\n      });\n      console.log('âœ… ì¶”ê°€ëœ ì•„ìŠ¤ë‚  ë‰´ìŠ¤:', title, '- ë§í¬:', link);\n    }\n  }\n}\n\nconsole.log('ì´ ë°œê²¬ëœ ì•„ìŠ¤ë‚  ë‰´ìŠ¤ ê°œìˆ˜:', newsItems.length);\n\nif (newsItems.length === 0) {\n  console.log('BBC Football RSSì—ì„œ ì•„ìŠ¤ë‚  ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n  return [{\n    title: 'ğŸ“° ì•„ìŠ¤ë‚  ê´€ë ¨ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤',\n    link: 'http://feeds.bbci.co.uk/sport/football/rss.xml',\n    timestamp: new Date().toISOString(),\n    team: 'Arsenal',\n    isNoNews: true\n  }];\n}\n\nreturn newsItems;"
      },
      "id": "arsenal-parser",
      "name": "ì•„ìŠ¤ë‚  ë‰´ìŠ¤ íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "jsCode": "// BBC ë‰´ìŠ¤ë¥¼ ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ë¡œ ë³€í™˜\nconst items = $input.all();\nconst messages = [];\n\nfor (const item of items) {\n  let messageText;\n  \n  // ë‰´ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°ì™€ ìˆëŠ” ê²½ìš°ë¥¼ êµ¬ë¶„\n  if (item.json.isNoNews) {\n    messageText = `âš½ ì•„ìŠ¤ë‚  ë‰´ìŠ¤ ëª¨ë‹ˆí„°ë§\\n\\nğŸ“° ${item.json.title}\\n\\nğŸ”— BBC Football ë‰´ìŠ¤ ì „ì²´ë³´ê¸°: ${item.json.link}\\n\\nâ° ${new Date().toLocaleString('ko-KR')}`;\n  } else {\n    messageText = `âš½ ì•„ìŠ¤ë‚  ë‰´ìŠ¤ ì•Œë¦¼ (BBC)\\n\\nğŸ“Œ ${item.json.title}\\n\\nğŸ”— ë§í¬: ${item.json.link}\\n\\nâ° ${new Date().toLocaleString('ko-KR')}`;\n  }\n  \n  const message = {\n    object_type: \"text\",\n    text: messageText,\n    link: {\n      web_url: item.json.link\n    }\n  };\n  \n  messages.push({\n    template_object: JSON.stringify(message)\n  });\n}\n\nconsole.log('BBC ë©”ì‹œì§€ ê°œìˆ˜:', messages.length);\nreturn messages;"
      },
      "id": "message-formatter",
      "name": "ë©”ì‹œì§€ í¬ë§·íŒ…",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kapi.kakao.com/v2/api/talk/memo/default/send",
        "authentication": "none",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $env.KAKAO_ACCESS_TOKEN }}"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ]
        },
        "sendBody": true,
        "bodyContentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "template_object",
              "value": "={{ $json.template_object }}"
            }
          ]
        },
        "options": {}
      },
      "id": "kakao-send",
      "name": "ì¹´ì¹´ì˜¤í†¡ ì „ì†¡",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1120, 300]
    }
  ],
  "connections": {
    "ë§¤ì¼ ì˜¤í›„ 12ì‹œ": {
      "main": [
        [
          {
            "node": "BBC Football RSS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BBC Football RSS": {
      "main": [
        [
          {
            "node": "ì•„ìŠ¤ë‚  ë‰´ìŠ¤ íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì•„ìŠ¤ë‚  ë‰´ìŠ¤ íŒŒì‹±": {
      "main": [
        [
          {
            "node": "ë©”ì‹œì§€ í¬ë§·íŒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë©”ì‹œì§€ í¬ë§·íŒ…": {
      "main": [
        [
          {
            "node": "ì¹´ì¹´ì˜¤í†¡ ì „ì†¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "1"
}
